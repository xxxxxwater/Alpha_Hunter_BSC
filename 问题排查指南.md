# Alpha Hunter - 问题排查指南

## 常见问题解决方案

### ❌ 问题1: 无法连接到BSC节点

**错误信息**:
```
ConnectionError: 无法连接到BSC节点: https://bsc-dataseed1.binance.org
```

**解决方案**:

#### 方案A: 使用RPC测试工具（推荐）

1. 运行RPC测试工具：
   - 双击 `测试RPC连接.bat`
   - 或命令行运行: `python test_rpc_connection.py`

2. 查看测试结果：
   ```
   ✅ 推荐使用: https://bsc-dataseed.binance.org
      延迟: 156ms (最快)
   ```

3. 如果有可用节点，程序会自动使用

#### 方案B: 配置自定义RPC

如果公共RPC都不可用，配置自己的RPC节点：

1. 创建或编辑 `.env` 文件
2. 添加配置：
   ```bash
   BSC_RPC_URL=https://your-custom-rpc.com
   ```

推荐的RPC服务（有免费额度）：

| 服务 | 免费额度 | 注册链接 |
|------|---------|---------|
| QuickNode | 300K/月 | https://www.quicknode.com/ |
| Moralis | 40K/天 | https://moralis.io/ |
| Ankr | 250M/月 | https://www.ankr.com/ |
| GetBlock | 40K/天 | https://getblock.io/ |

#### 方案C: 网络问题排查

1. **检查网络连接**
   ```bash
   ping bsc-dataseed.binance.org
   ```

2. **使用VPN**
   - 某些地区可能限制访问BSC节点
   - 尝试使用VPN更换节点

3. **检查防火墙**
   - 确保防火墙没有阻止HTTPS连接
   - 允许Python访问网络

---

### ❌ 问题2: 'ch' is not recognized as an internal or external command

**错误信息**:
```
'ch' is not recognized as an internal or external command
```

**原因**: 
启动脚本的编码命令 `chcp` 可能在某些系统上无法识别

**解决方案**:

#### 方案A: 直接使用Python运行

不使用批处理文件，直接运行：
```bash
python auto_trade_dual.py
```

#### 方案B: 已修复

新版本的启动脚本已经修复此问题，如果仍然出现：

1. 重新下载最新版本
2. 或手动编辑 `启动_双聚合器.bat`：
   ```batch
   @echo off
   chcp 65001 >nul 2>&1
   if errorlevel 1 (
       echo Warning: Unable to set UTF-8 encoding
   )
   python auto_trade_dual.py
   pause
   ```

---

### ⚠️ 问题3: API限流（Rate Limiting）

**错误信息**:
```
[LI.FI] API限流，跳过
[1INCH] API限流，跳过
[ERROR] 所有聚合器都无法获取报价
```

**原因**:
- 请求过于频繁
- 达到API限流上限

**解决方案**:

#### 方案A: 等待重试
程序内置了限流保护，会自动等待：
```
[LIMIT] 达到API限流，等待 45.2秒...
```

#### 方案B: 增加检查间隔
编辑 `.env` 文件，增加检查间隔：
```bash
CHECK_INTERVAL=120  # 改为2分钟检查一次
```

#### 方案C: 配置1inch API密钥
在 `.env` 文件中添加：
```bash
ONEINCH_API_KEY=your_api_key_here
```

获取1inch API密钥：https://portal.1inch.dev/

#### 方案D: 减少持仓数量
编辑 `.env` 文件：
```bash
MAX_POSITIONS=3  # 减少同时监控的代币数量
```

---

### ⚠️ 问题4: 交易失败

**错误信息**:
```
[FAILED] 交易失败!
```

**常见原因**:

#### 原因1: Gas不足
**解决方案**: 钱包保留足够的BNB用于Gas费
```bash
# 建议至少保留
BNB余额 > 交易金额 + 0.005 BNB (Gas预留)
```

#### 原因2: 滑点过小
**解决方案**: 增加滑点容忍度

编辑 `.env` 文件：
```bash
SLIPPAGE=0.20  # 从15%增加到20%
```

⚠️ 注意：滑点过大可能导致价格损失

#### 原因3: 流动性不足
**解决方案**: 
- 检查代币是否有足够流动性
- 减少交易金额
- 换个时间段交易

#### 原因4: 代币合约问题
某些代币可能有：
- 反垃圾机制
- 转账税
- 黑名单功能

**解决方案**: 在BSCScan查看代币合约，确认是否安全

---

### ⚠️ 问题5: Python环境问题

**错误信息**:
```
'python' is not recognized as an internal or external command
```

**解决方案**:

#### 方案A: 安装Python
1. 下载Python 3.8+: https://www.python.org/downloads/
2. 安装时勾选 "Add Python to PATH"
3. 重启命令行

#### 方案B: 使用完整路径
找到Python安装路径，例如：
```bash
C:\Python39\python.exe auto_trade_dual.py
```

#### 方案C: 验证安装
```bash
python --version
# 应该显示: Python 3.x.x
```

---

### ⚠️ 问题6: 依赖包缺失

**错误信息**:
```
ModuleNotFoundError: No module named 'web3'
```

**解决方案**:

安装所有依赖：
```bash
pip install -r requirements.txt
```

或单独安装缺失的包：
```bash
pip install web3
pip install requests
pip install python-dotenv
pip install eth-account
```

---

### ⚠️ 问题7: .env文件未配置

**错误信息**:
```
[错误] 未配置私钥
[提示] 请在 .env 文件中设置 PRIVATE_KEY
```

**解决方案**:

1. 复制示例文件：
   ```bash
   copy env_example.txt .env
   ```

2. 编辑 `.env` 文件，填入配置：
   ```bash
   PRIVATE_KEY=你的私钥
   INITIAL_INVESTMENT=0.025
   SLIPPAGE=0.15
   ```

3. 保存并重新运行

⚠️ **安全提示**: 
- 不要分享你的私钥
- 不要上传 `.env` 文件到GitHub
- 使用测试钱包进行初次测试

---

## 调试技巧

### 1. 查看日志文件

程序运行时会生成日志：
```bash
alpha_hunter.log
```

使用文本编辑器打开，查看详细错误信息。

### 2. 测试模式

可以先用小金额测试：
```bash
INITIAL_INVESTMENT=0.001  # 用0.001 BNB测试
```

### 3. 逐步排查

按顺序检查：
1. ✅ Python安装
2. ✅ 依赖包安装
3. ✅ .env文件配置
4. ✅ RPC连接
5. ✅ 钱包余额
6. ✅ 网络连接

### 4. 使用测试工具

运行各种测试：

**测试RPC连接**:
```bash
python test_rpc_connection.py
```

**测试钱包余额**:
```python
from web3 import Web3
w3 = Web3(Web3.HTTPProvider("https://bsc-dataseed.binance.org"))
balance = w3.eth.get_balance("你的地址")
print(f"余额: {w3.from_wei(balance, 'ether')} BNB")
```

---

## 获取帮助

### 检查更新
定期检查是否有新版本和bug修复

### 社区支持
- GitHub Issues
- Telegram群组
- Discord频道

### 报告问题
报告问题时请提供：
1. 错误信息（截图或文字）
2. 日志文件 (`alpha_hunter.log`)
3. 系统环境（Windows版本、Python版本）
4. 操作步骤

---

## 快速命令参考

```bash
# 测试RPC连接
python test_rpc_connection.py

# 运行程序
python auto_trade_dual.py

# 查看Python版本
python --version

# 安装依赖
pip install -r requirements.txt

# 查看日志
type alpha_hunter.log  # Windows
cat alpha_hunter.log   # Linux/Mac
```

---

## 预防措施

1. **定期备份**
   - 定期备份 `positions.json`
   - 备份 `.env` 配置（注意安全）

2. **监控运行**
   - 定期查看日志
   - 监控钱包余额
   - 检查持仓状态

3. **风险管理**
   - 不要投入全部资金
   - 设置合理的投资金额
   - 理解止盈策略

4. **安全建议**
   - 使用独立的交易钱包
   - 定期更新程序
   - 谨慎处理私钥

---

## 更新日期
2025-10-27

## 相关文档
- [连接问题修复说明.md](连接问题修复说明.md)
- [双聚合器版本说明.md](双聚合器版本说明.md)
- [README.md](README.md)

